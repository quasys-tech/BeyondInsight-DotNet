ÌO
2C:\Users\abdul\source\repos\BeyondInsight\Utils.cs
	namespace 	
BeyondInsight
 
{ 
internal 
class 
Utils 
{		 
static 
Utils 
( 
) 
{ 	
Log 
. 
Logger 
= 
new 
LoggerConfiguration 0
(0 1
)1 2
. 
MinimumLevel 
. 
Debug 
(  
)  !
. 
WriteTo 
. 
Trace 
( 
) 
. 
CreateLogger 
( 
) 
; 
} 	
public 
static 
void 
log 
( 
String %
message& -
,- .
LogLevel/ 7
level8 =
)= >
{ 	
switch 
( 
level 
) 
{ 
case 
LogLevel 
. 
Trace #
:# $
case 
LogLevel 
. 
Debug #
:# $
Log 
. 
Debug 
( 
message %
)% &
;& '
break 
; 
case 
LogLevel 
. 
Information )
:) *
Log 
. 
Information #
(# $
message$ +
)+ ,
;, -
break 
; 
case 
LogLevel 
. 
Warning %
:% &
Log 
. 
Warning 
(  
message  '
)' (
;( )
break   
;   
case!! 
LogLevel!! 
.!! 
Error!! #
:!!# $
Log"" 
."" 
Error"" 
("" 
message"" %
)""% &
;""& '
break## 
;## 
case$$ 
LogLevel$$ 
.$$ 
Critical$$ &
:$$& '
Log%% 
.%% 
Fatal%% 
(%% 
message%% %
)%%% &
;%%& '
break&& 
;&& 
default'' 
:'' 
Log(( 
.(( 
Information(( #
(((# $
message(($ +
)((+ ,
;((, -
break)) 
;)) 
}** 
}++ 	
public-- 
static-- 
JObject-- 
createSecretFile-- .
(--. /
JObject--/ 6
secret--7 =
,--= >
String--? E
content--F M
)--M N
{.. 	
String// 
path// 
=// 
secret//  
.//  !
Value//! &
<//& '
string//' -
>//- .
(//. /
$str/// ;
)//; <
.//< =
Replace//= D
(//D E
$str//E I
,//I J
$str//K N
)//N O
+//P Q
$str//R U
+//V W
secret//X ^
.//^ _
Value//_ d
<//d e
string//e k
>//k l
(//l m
$str//m t
)//t u
;//u v
String00 
filePath00 
=00 
createFolders00 +
(00+ ,
path00, 0
)000 1
;001 2
File11 
.11 
WriteAllText11 
(11 
filePath11 &
,11& '
content11( /
+110 1
$str112 6
)116 7
;117 8
JObject33 

jsonObject33 
=33  
new33! $
JObject33% ,
(33, -
)33- .
;33. /

jsonObject44 
.44 
Add44 
(44 
$str44 %
,44% &
secret44' -
.44- .
Value44. 3
<443 4
string444 :
>44: ;
(44; <
$str44< F
)44F G
??44H J
$str44K M
)44M N
;44N O

jsonObject55 
.55 
Add55 
(55 
$str55 "
,55" #
secret55$ *
.55* +
Value55+ 0
<550 1
string551 7
>557 8
(558 9
$str559 @
)55@ A
)55A B
;55B C

jsonObject66 
.66 
Add66 
(66 
$str66 %
,66% &
secret66' -
.66- .
Value66. 3
<663 4
string664 :
>66: ;
(66; <
$str66< F
)66F G
??66H J
$str66K M
)66M N
;66N O

jsonObject77 
.77 
Add77 
(77 
$str77 '
,77' (
secret77) /
.77/ 0
Value770 5
<775 6
string776 <
>77< =
(77= >
$str77> J
)77J K
)77K L
;77L M

jsonObject88 
.88 
Add88 
(88 
$str88 %
,88% &
filePath88' /
)88/ 0
;880 1

jsonObject99 
.99 
Add99 
(99 
$str99 )
,99) *
true99+ /
)99/ 0
;990 1
return:: 

jsonObject:: 
;:: 
};; 	
public== 
static== 
JObject== !
convertSecretToObject== 3
(==3 4
JObject==4 ;
secret==< B
)==B C
{>> 	
JObject?? 

jsonObject?? 
=??  
new??! $
JObject??% ,
(??, -
)??- .
;??. /

jsonObject@@ 
.@@ 
Add@@ 
(@@ 
$str@@ %
,@@% &
secret@@' -
.@@- .
Value@@. 3
<@@3 4
string@@4 :
>@@: ;
(@@; <
$str@@< F
)@@F G
)@@G H
;@@H I

jsonObjectAA 
.AA 
AddAA 
(AA 
$strAA "
,AA" #
secretAA$ *
.AA* +
ValueAA+ 0
<AA0 1
stringAA1 7
>AA7 8
(AA8 9
$strAA9 @
)AA@ A
)AAA B
;AAB C

jsonObjectBB 
.BB 
AddBB 
(BB 
$strBB %
,BB% &
secretBB' -
.BB- .
ValueBB. 3
<BB3 4
stringBB4 :
>BB: ;
(BB; <
$strBB< F
)BBF G
??BBH J
$strBBK M
)BBM N
;BBN O

jsonObjectCC 
.CC 
AddCC 
(CC 
$strCC '
,CC' (
secretCC) /
.CC/ 0
ValueCC0 5
<CC5 6
stringCC6 <
>CC< =
(CC= >
$strCC> J
)CCJ K
)CCK L
;CCL M

jsonObjectDD 
.DD 
AddDD 
(DD 
$strDD %
,DD% &
$strDD' )
)DD) *
;DD* +

jsonObjectEE 
.EE 
AddEE 
(EE 
$strEE )
,EE) *
falseEE+ 0
)EE0 1
;EE1 2
returnFF 

jsonObjectFF 
;FF 
}GG 	
publicJJ 
staticJJ 
JObjectJJ )
convertManagedAccountToObjectJJ ;
(JJ; <
JObjectJJ< C
secretJJD J
,JJJ K
StringJJL R
contentJJS Z
)JJZ [
{KK 	
JObjectLL 

jsonObjectLL 
=LL  
newLL! $
JObjectLL% ,
(LL, -
)LL- .
;LL. /

jsonObjectMM 
.MM 
AddMM 
(MM 
$strMM %
,MM% &
contentMM' .
)MM. /
;MM/ 0

jsonObjectNN 
.NN 
AddNN 
(NN 
$strNN '
,NN' (
secretNN) /
.NN/ 0
ValueNN0 5
<NN5 6
stringNN6 <
>NN< =
(NN= >
$strNN> J
)NNJ K
)NNK L
;NNL M

jsonObjectOO 
.OO 
AddOO 
(OO 
$strOO (
,OO( )
secretOO* 0
.OO0 1
ValueOO1 6
<OO6 7
stringOO7 =
>OO= >
(OO> ?
$strOO? L
)OOL M
)OOM N
;OON O

jsonObjectPP 
.PP 
AddPP 
(PP 
$strPP '
,PP' (
secretPP) /
.PP/ 0
ValuePP0 5
<PP5 6
stringPP6 <
>PP< =
(PP= >
$strPP> J
)PPJ K
+PPL M
$strPPN Q
+PPR S
secretPPT Z
.PPZ [
ValuePP[ `
<PP` a
stringPPa g
>PPg h
(PPh i
$strPPi v
)PPv w
)PPw x
;PPx y

jsonObjectQQ 
.QQ 
AddQQ 
(QQ 
$strQQ )
,QQ) *
falseQQ+ 0
)QQ0 1
;QQ1 2
returnRR 

jsonObjectRR 
;RR 
}SS 	
publicUU 
staticUU 
StringUU 
createFoldersUU *
(UU* +
StringUU+ 1
pathUU2 6
)UU6 7
{VV 	
stringWW 

folderPathWW 
=WW 
PathWW  $
.WW$ %
CombineWW% ,
(WW, -
SettingsWW- 5
.WW5 6
SECRETS_PATHWW6 B
,WWB C
pathWWD H
)WWH I
;WWI J
stringXX 
parentDirectoryXX "
=XX# $
PathXX% )
.XX) *
GetDirectoryNameXX* :
(XX: ;

folderPathXX; E
)XXE F
;XXF G
ifZZ 
(ZZ 
!ZZ 
	DirectoryZZ 
.ZZ 
ExistsZZ !
(ZZ! "
parentDirectoryZZ" 1
)ZZ1 2
)ZZ2 3
{[[ 
	Directory\\ 
.\\ 
CreateDirectory\\ )
(\\) *
parentDirectory\\* 9
)\\9 :
;\\: ;
}]] 
return^^ 

folderPath^^ 
;^^ 
}__ 	
}`` 
}aa Ê
5C:\Users\abdul\source\repos\BeyondInsight\Settings.cs
	namespace 	
BeyondInsight
 
{ 
public 

class 
Settings 
{ 
public 
static 
String 

BT_API_URL '
=( )
Environment* 5
.5 6"
GetEnvironmentVariable6 L
(L M
$strM Y
)Y Z
;Z [
public 
static 
String 
REQUEST_HEADERS ,
=- .
$str/ =
+> ?
Environment@ K
.K L"
GetEnvironmentVariableL b
(b c
$strc o
)o p
;p q
public		 
static		 
bool		 &
FETCH_ALL_MANAGED_ACCOUNTS		 5
=		6 7
bool		8 <
.		< =
TryParse		= E
(		E F"
GetEnvironmentVariable		F \
(		\ ]
$str		] y
,		y z
$str			{ 
)
		 
,
		 
out
		 
var
		 
result
		 
)
		 
&&
		 
result
		 
;
		 
public 
static 
String 
APP_PATH %
=& '
$str( 6
;6 7
public 
static 
String "
DEFAULT_SECRETS_FOLDER 3
=4 5
$str6 E
;E F
public 
static 
String 
SECRETS_PATH )
=* +
APP_PATH, 4
+5 6
$str7 :
+; <"
DEFAULT_SECRETS_FOLDER= S
;S T
static 
Settings 
( 
) 
{ 	
String 
secretsPath 
=  
Environment! ,
., -"
GetEnvironmentVariable- C
(C D
$strD R
)R S
;S T
if 
( 
! 
string 
. 
IsNullOrWhiteSpace *
(* +
secretsPath+ 6
)6 7
)7 8
{ 
SECRETS_PATH 
= 
secretsPath *
;* +
} 
} 	
public 
static 
String 
SECRETS_LIST )
=* +"
GetEnvironmentVariable, B
(B C
$strC Q
,Q R
$strS U
)U V
;V W
public 
static 
String 
FOLDER_LIST (
=) *"
GetEnvironmentVariable+ A
(A B
$strB O
,O P
$strQ S
)S T
;T U
public 
static 
String !
MANAGED_ACCOUNTS_LIST 2
=3 4"
GetEnvironmentVariable5 K
(K L
$strL c
,c d
$stre g
)g h
;h i
public 
static 
String !
BT_CLIENT_CERTIFICATE 2
=3 4
Environment5 @
.@ A"
GetEnvironmentVariableA W
(W X
$strX o
)o p
;p q
public 
static 
String 
EXCECUTION_ID *
=+ ,
null- 1
;1 2
public   
static   
String   
APP_VERSION   (
=  ) *
$str  + 2
;  2 3
public## 
static## 
string## "
GetEnvironmentVariable## 3
(##3 4
string##4 :
key##; >
,##> ?
string##@ F
defaultValue##G S
)##S T
{$$ 	
var%% 
value%% 
=%% 
Environment%% #
.%%# $"
GetEnvironmentVariable%%$ :
(%%: ;
key%%; >
)%%> ?
;%%? @
return&& 
value&& 
??&& 
defaultValue&& (
;&&( )
}'' 	
}(( 
})) ÌØ
4C:\Users\abdul\source\repos\BeyondInsight\Service.cs
	namespace 	
BeyondInsight
 
{		 
internal

 
class

 
Service

 
{ 
private 
static 
String 
cookie $
;$ %
private 
static 
HttpClientHandler (#
createHttpClientHandler) @
(@ A
)A B
{ 	
var 

certBase64 
= 
Settings %
.% &!
BT_CLIENT_CERTIFICATE& ;
.; <
Replace< C
(C D
$strD a
,a b
$strc e
)e f
. 
Replace 
( 
$str 4
,4 5
$str6 8
)8 9
. 
Replace 
( 
$str 
, 
$str !
)! "
. 
Replace 
( 
$str 
, 
$str !
)! "
. 
Trim 
( 
) 
; 
var 
	certBytes 
= 
Convert #
.# $
FromBase64String$ 4
(4 5

certBase645 ?
)? @
;@ A
var 
trustedCert 
= 
new !
X509Certificate2" 2
(2 3
	certBytes3 <
)< =
;= >
var 
handler 
= 
new 
HttpClientHandler /
(/ 0
)0 1
;1 2
handler 
. 5
)ServerCertificateCustomValidationCallback =
=> ?
(@ A
senderA G
,G H
certI M
,M N
chainO T
,T U
sslPolicyErrorsV e
)e f
=>g i
{ 
var 

serverCert 
=  
new! $
X509Certificate2% 5
(5 6
cert6 :
): ;
;; <
return 

serverCert !
.! "

Thumbprint" ,
==- /
trustedCert0 ;
.; <

Thumbprint< F
;F G
} 
; 
handler 
. 
SslProtocols  
=! "
System# )
.) *
Security* 2
.2 3
Authentication3 A
.A B
SslProtocolsB N
.N O
Tls12O T
;T U
handler   
.   
CookieContainer   #
=  $ %
new  & )
CookieContainer  * 9
(  9 :
)  : ;
;  ; <
handler!! 
.!! 
CookieContainer!! #
.!!# $

SetCookies!!$ .
(!!. /
new!!/ 2
Uri!!3 6
(!!6 7
Settings!!7 ?
.!!? @

BT_API_URL!!@ J
)!!J K
,!!K L
cookie!!M S
)!!S T
;!!T U
return"" 
handler"" 
;"" 
}## 	
public$$ 
static$$ 
async$$ 
Task$$  
<$$  !
string$$! '
>$$' (
	SignAppIn$$) 2
($$2 3
)$$3 4
{%% 	
String&& 
url&& 
=&& 
Settings&& !
.&&! "

BT_API_URL&&" ,
+&&- .
$str&&/ @
;&&@ A
cookie'' 
='' 
$str'' 
;'' 
HttpClientHandler(( 
handler(( %
=((& '#
createHttpClientHandler((( ?
(((? @
)((@ A
;((A B

HttpClient)) 
client)) 
=)) 
new))  #

HttpClient))$ .
()). /
handler))/ 6
)))6 7
;))7 8
HttpRequestMessage** 
request** &
=**' (
new**) ,
HttpRequestMessage**- ?
(**? @

HttpMethod**@ J
.**J K
Post**K O
,**O P
url**Q T
)**T U
;**U V
request++ 
.++ 
Headers++ 
.++ 
Add++ 
(++  
$str++  (
,++( )
$str++* <
)++< =
;++= >
request,, 
.,, 
Headers,, 
.,, #
TryAddWithoutValidation,, 3
(,,3 4
$str,,4 C
,,,C D
Settings,,E M
.,,M N
REQUEST_HEADERS,,N ]
),,] ^
;,,^ _
request.. 
... 
Content.. 
=.. 
new.. !
StringContent.." /
(../ 0
$str..0 2
,..2 3
System..4 :
...: ;
Text..; ?
...? @
Encoding..@ H
...H I
UTF8..I M
,..M N
$str..O a
)..a b
;..b c
HttpResponseMessage11 
response11  (
=11) *
await11+ 0
client111 7
.117 8
	SendAsync118 A
(11A B
request11B I
)11I J
;11J K
String22 
responseBody22 
=22  !
await22" '
response22( 0
.220 1
Content221 8
.228 9
ReadAsStringAsync229 J
(22J K
)22K L
;22L M
if33 
(33 
response33 
.33 

StatusCode33 #
==33$ &
HttpStatusCode33' 5
.335 6
OK336 8
)338 9
{44 
if55 
(55 
response55 
.55 
Headers55 $
.55$ %
TryGetValues55% 1
(551 2
$str552 >
,55> ?
out55@ C
var55D G
cookieValues55H T
)55T U
)55U V
{66 
cookie77 
=77 
String77 #
.77# $
Join77$ (
(77( )
$str77) -
,77- .
cookieValues77/ ;
)77; <
;77< =
}88 
Utils99 
.99 
log99 
(99 
$str99 /
,99/ 0
LogLevel991 9
.999 :
Information99: E
)99E F
;99F G
return:: 
responseBody:: #
.::# $
ToString::$ ,
(::, -
)::- .
;::. /
};; 
Utils<< 
.<< 
log<< 
(<< 
$str<< 5
+<<6 7
responseBody<<8 D
.<<D E
ToString<<E M
(<<M N
)<<N O
,<<O P
LogLevel<<Q Y
.<<Y Z
Error<<Z _
)<<_ `
;<<` a
return== 
null== 
;== 
}>> 	
public@@ 
static@@ 
async@@ 
Task@@  
<@@  !
bool@@! %
>@@% &

signAppOut@@' 1
(@@1 2
)@@2 3
{AA 	
StringBB 
urlBB 
=BB 
SettingsBB !
.BB! "

BT_API_URLBB" ,
+BB- .
$strBB/ >
;BB> ?
HttpClientHandlerCC 
handlerCC %
=CC& '#
createHttpClientHandlerCC( ?
(CC? @
)CC@ A
;CCA B

HttpClientDD 
clientDD 
=DD 
newDD  #

HttpClientDD$ .
(DD. /
handlerDD/ 6
)DD6 7
;DD7 8
HttpRequestMessageEE 
requestEE &
=EE' (
newEE) ,
HttpRequestMessageEE- ?
(EE? @

HttpMethodEE@ J
.EEJ K
PostEEK O
,EEO P
urlEEQ T
)EET U
;EEU V
requestFF 
.FF 
ContentFF 
=FF 
newFF !
StringContentFF" /
(FF/ 0
$strFF0 2
,FF2 3
SystemFF4 :
.FF: ;
TextFF; ?
.FF? @
EncodingFF@ H
.FFH I
UTF8FFI M
,FFM N
$strFFO a
)FFa b
;FFb c
HttpResponseMessageGG 
responseGG  (
=GG) *
awaitGG+ 0
clientGG1 7
.GG7 8
	SendAsyncGG8 A
(GGA B
requestGGB I
)GGI J
;GGJ K
StringHH 
responseBodyHH 
=HH  !
awaitHH" '
responseHH( 0
.HH0 1
ContentHH1 8
.HH8 9
ReadAsStringAsyncHH9 J
(HHJ K
)HHK L
;HHL M
ifII 
(II 
responseII 
.II 

StatusCodeII #
==II$ &
HttpStatusCodeII' 5
.II5 6
OKII6 8
)II8 9
{JJ 
UtilsKK 
.KK 
logKK 
(KK 
$strKK /
,KK/ 0
LogLevelKK1 9
.KK9 :
InformationKK: E
)KKE F
;KKF G
cookieLL 
=LL 
$strLL 
;LL 
returnMM 
trueMM 
;MM 
}NN 
UtilsOO 
.OO 
logOO 
(OO 
$strOO B
,OOB C
LogLevelOOD L
.OOL M
ErrorOOM R
)OOR S
;OOS T
returnPP 
falsePP 
;PP 
}QQ 	
publicSS 
staticSS 
asyncSS 
TaskSS  
<SS  !
StringSS! '
>SS' (
getSecretByPathSS) 8
(SS8 9
StringSS9 ?
pathSS@ D
,SSD E
StringSSF L
titleSSM R
,SSR S
charSST X
	separatorSSY b
,SSb c
boolSSd h
	sendTitleSSi r
)SSr s
{TT 	
StringUU 
urlUU 
=UU 
SettingsUU !
.UU! "

BT_API_URLUU" ,
+UU- .
$strUU/ F
+UUG H
$strUUI Q
+UUR S
pathUUT X
+UUY Z
$strUU[ h
+UUi j
	separatorUUk t
;UUt u
ifVV 
(VV 
	sendTitleVV 
)VV 
{WW 
urlXX 
=XX 
SettingsXX 
.XX 

BT_API_URLXX )
+XX* +
$strXX, C
+XXD E
$strXXF O
+XXP Q
titleXXR W
+XXX Y
$strXXZ b
+XXc d
pathXXe i
+XXj k
$strXXl y
+XXz {
	separator	XX| 
;
XX 
}YY 
HttpClientHandlerZZ 
handlerZZ %
=ZZ& '#
createHttpClientHandlerZZ( ?
(ZZ? @
)ZZ@ A
;ZZA B

HttpClient]] 
client]] 
=]] 
new]]  #

HttpClient]]$ .
(]]. /
handler]]/ 6
)]]6 7
;]]7 8
HttpRequestMessage^^ 
request^^ &
=^^' (
new^^) ,
HttpRequestMessage^^- ?
(^^? @

HttpMethod^^@ J
.^^J K
Get^^K N
,^^N O
url^^P S
)^^S T
;^^T U
request__ 
.__ 
Headers__ 
.__ 
Add__ 
(__  
$str__  (
,__( )
$str__* <
)__< =
;__= >
request`` 
.`` 
Headers`` 
.`` #
TryAddWithoutValidation`` 3
(``3 4
$str``4 C
,``C D
Settings``E M
.``M N
REQUEST_HEADERS``N ]
)``] ^
;``^ _
HttpResponseMessageaa 
responseaa  (
=aa) *
awaitaa+ 0
clientaa1 7
.aa7 8
	SendAsyncaa8 A
(aaA B
requestaaB I
)aaI J
;aaJ K
Stringbb 
responseBodybb 
=bb  !
awaitbb" '
responsebb( 0
.bb0 1
Contentbb1 8
.bb8 9
ReadAsStringAsyncbb9 J
(bbJ K
)bbK L
;bbL M
ifcc 
(cc 
responsecc 
.cc 

StatusCodecc #
==cc$ &
HttpStatusCodecc' 5
.cc5 6
OKcc6 8
)cc8 9
{dd 
returnee 
responseBodyee #
.ee# $
ToStringee$ ,
(ee, -
)ee- .
;ee. /
}ff 
Utilsgg 
.gg 
loggg 
(gg 
$strgg O
+ggP Q
pathggR V
+ggW X
$strggY f
+ggg h
titleggi n
+ggo p
$strggq 
+
gg 
responseBody
gg 
.
gg 
ToString
gg 
(
gg 
)
gg 
,
gg 
LogLevel
gg £
.
gg£ ¤
Error
gg¤ ©
)
gg© ª
;
ggª «
ifhh 
(hh 
!hh 

signAppOuthh 
(hh 
)hh 
.hh 
Resulthh $
)hh$ %
{ii 
Utilsjj 
.jj 
logjj 
(jj 
$strjj 4
,jj4 5
LogLeveljj6 >
.jj> ?
Errorjj? D
)jjD E
;jjE F
}kk 
returnll 
nullll 
;ll 
}mm 	
publicoo 
staticoo 
asyncoo 
Taskoo  
<oo  !
Stringoo! '
>oo' (
getSecretFilebyIdoo) :
(oo: ;
Stringoo; A
secretIdooB J
)ooJ K
{pp 	
Stringqq 
urlqq 
=qq 
Settingsqq !
.qq! "

BT_API_URLqq" ,
+qq- .
$strqq/ G
+qqH I
secretIdqqJ R
+qqS T
$strqqU e
;qqe f
HttpClientHandlerrr 
handlerrr %
=rr& '#
createHttpClientHandlerrr( ?
(rr? @
)rr@ A
;rrA B

HttpClienttt 
clienttt 
=tt 
newtt  #

HttpClienttt$ .
(tt. /
handlertt/ 6
)tt6 7
;tt7 8
HttpRequestMessageuu 
requestuu &
=uu' (
newuu) ,
HttpRequestMessageuu- ?
(uu? @

HttpMethoduu@ J
.uuJ K
GetuuK N
,uuN O
urluuP S
)uuS T
;uuT U
requestvv 
.vv 
Headersvv 
.vv 
Addvv 
(vv  
$strvv  (
,vv( )
$strvv* <
)vv< =
;vv= >
requestww 
.ww 
Headersww 
.ww #
TryAddWithoutValidationww 3
(ww3 4
$strww4 C
,wwC D
SettingswwE M
.wwM N
REQUEST_HEADERSwwN ]
)ww] ^
;ww^ _
HttpResponseMessagexx 
responsexx  (
=xx) *
awaitxx+ 0
clientxx1 7
.xx7 8
	SendAsyncxx8 A
(xxA B
requestxxB I
)xxI J
;xxJ K
Stringyy 
responseBodyyy 
=yy  !
awaityy" '
responseyy( 0
.yy0 1
Contentyy1 8
.yy8 9
ReadAsStringAsyncyy9 J
(yyJ K
)yyK L
;yyL M
ifzz 
(zz 
responsezz 
.zz 

StatusCodezz #
==zz$ &
HttpStatusCodezz' 5
.zz5 6
OKzz6 8
)zz8 9
{{{ 
return|| 
responseBody|| #
.||# $
ToString||$ ,
(||, -
)||- .
;||. /
}}} 
Utils~~ 
.~~ 
log~~ 
(~~ 
string~~ 
.~~ 
Format~~ #
(~~# $
$str~~$ d
,~~d e
secretId~~f n
,~~n o
response~~p x
.~~x y
ToString	~~y 
(
~~ 
)
~~ 
)
~~ 
,
~~ 
LogLevel
~~ 
.
~~ 
Error
~~ 
)
~~ 
;
~~ 
if 
( 
! 

signAppOut 
( 
) 
. 
Result $
)$ %
{
 
Utils
 
.
 
log
 
(
 
$str
 4
,
4 5
LogLevel
6 >
.
> ?
Error
? D
)
D E
;
E F
}
 
return
 
null
 
;
 
}
 	
public
 
static
 
async
 
Task
  
<
  !
String
! '
>
' ( 
getManagedAccounts
) ;
(
; <
String
< B

systemName
C M
,
M N
String
O U
accountName
V a
)
a b
{
 	
String
 
url
 
=
 
Settings
 !
.
! "

BT_API_URL
" ,
+
- .
$str
/ M
+
N O

systemName
P Z
+
[ \
$str
] l
+
m n
accountName
o z
;
z {
HttpClientHandler
 
handler
 %
=
& '%
createHttpClientHandler
( ?
(
? @
)
@ A
;
A B

HttpClient
 
client
 
=
 
new
  #

HttpClient
$ .
(
. /
handler
/ 6
)
6 7
;
7 8 
HttpRequestMessage
 
request
 &
=
' (
new
) , 
HttpRequestMessage
- ?
(
? @

HttpMethod
@ J
.
J K
Get
K N
,
N O
url
P S
)
S T
;
T U
request
 
.
 
Headers
 
.
 
Add
 
(
  
$str
  (
,
( )
$str
* <
)
< =
;
= >
request
 
.
 
Headers
 
.
 %
TryAddWithoutValidation
 3
(
3 4
$str
4 C
,
C D
Settings
E M
.
M N
REQUEST_HEADERS
N ]
)
] ^
;
^ _!
HttpResponseMessage
 
response
  (
=
) *
await
+ 0
client
1 7
.
7 8
	SendAsync
8 A
(
A B
request
B I
)
I J
;
J K
String
 
responseBody
 
=
  !
await
" '
response
( 0
.
0 1
Content
1 8
.
8 9
ReadAsStringAsync
9 J
(
J K
)
K L
;
L M
if
 
(
 
response
 
.
 

StatusCode
 #
==
$ &
HttpStatusCode
' 5
.
5 6
OK
6 8
)
8 9
{
 
return
 
responseBody
 #
.
# $
ToString
$ ,
(
, -
)
- .
;
. /
}
 
Utils
 
.
 
log
 
(
 
string
 
.
 
Format
 #
(
# $
$str$ 
, 

systemName 
, 
accountName ¥
,¥ ¦
responseBody§ ³
.³ ´
ToString´ ¼
(¼ ½
)½ ¾
)¾ ¿
,¿ À
LogLevelÁ É
.É Ê
ErrorÊ Ï
)Ï Ð
;Ð Ñ
if
 
(
 
!
 

signAppOut
 
(
 
)
 
.
 
Result
 $
)
$ %
{
 
Utils
 
.
 
log
 
(
 
$str
 4
,
4 5
LogLevel
6 >
.
> ?
Error
? D
)
D E
;
E F
}
 
return
 
null
 
;
 
}
 	
public
 
static
 
async
 
Task
  
<
  !
String
! '
>
' ()
createRequestInPasswordSafe
) D
(
D E
int
E H
systemID
I Q
,
Q R
int
S V
	accountID
W `
)
` a
{
 	
String
 
url
 
=
 
Settings
 !
.
! "

BT_API_URL
" ,
+
- .
$str
/ :
;
: ;
string
   
body
   
=
   
$@"
   
$str
 ¢ 
{
¢¢ 
systemID
¢¢ 
}
¢¢ 
$str
¢£ 
{
££ 
	accountID
££ 
}
££ 
$str
£§ 
"
§§ 
;
§§ 
HttpClientHandler
¨¨ 
handler
¨¨ %
=
¨¨& '%
createHttpClientHandler
¨¨( ?
(
¨¨? @
)
¨¨@ A
;
¨¨A B

HttpClient
©© 
client
©© 
=
©© 
new
©©  #

HttpClient
©©$ .
(
©©. /
handler
©©/ 6
)
©©6 7
;
©©7 8 
HttpRequestMessage
ªª 
request
ªª &
=
ªª' (
new
ªª) , 
HttpRequestMessage
ªª- ?
(
ªª? @

HttpMethod
ªª@ J
.
ªªJ K
Post
ªªK O
,
ªªO P
url
ªªQ T
)
ªªT U
;
ªªU V
request
«« 
.
«« 
Headers
«« 
.
«« 
Add
«« 
(
««  
$str
««  (
,
««( )
$str
««* <
)
««< =
;
««= >
request
¬¬ 
.
¬¬ 
Headers
¬¬ 
.
¬¬ %
TryAddWithoutValidation
¬¬ 3
(
¬¬3 4
$str
¬¬4 C
,
¬¬C D
Settings
¬¬E M
.
¬¬M N
REQUEST_HEADERS
¬¬N ]
)
¬¬] ^
;
¬¬^ _
request
®® 
.
®® 
Content
®® 
=
®® 
new
®® !
StringContent
®®" /
(
®®/ 0
body
®®0 4
,
®®4 5
System
®®6 <
.
®®< =
Text
®®= A
.
®®A B
Encoding
®®B J
.
®®J K
UTF8
®®K O
,
®®O P
$str
®®Q c
)
®®c d
;
®®d e!
HttpResponseMessage
±± 
response
±±  (
=
±±) *
await
±±+ 0
client
±±1 7
.
±±7 8
	SendAsync
±±8 A
(
±±A B
request
±±B I
)
±±I J
;
±±J K
String
²² 
responseBody
²² 
=
²²  !
await
²²" '
response
²²( 0
.
²²0 1
Content
²²1 8
.
²²8 9
ReadAsStringAsync
²²9 J
(
²²J K
)
²²K L
;
²²L M
if
³³ 
(
³³ 
response
³³ 
.
³³ 

StatusCode
³³ #
==
³³$ &
HttpStatusCode
³³' 5
.
³³5 6
OK
³³6 8
||
³³9 ;
response
³³< D
.
³³D E

StatusCode
³³E O
==
³³P R
HttpStatusCode
³³S a
.
³³a b
Created
³³b i
)
³³i j
{
´´ 
return
µµ 
responseBody
µµ #
.
µµ# $
ToString
µµ$ ,
(
µµ, -
)
µµ- .
;
µµ. /
}
¶¶ 
Utils
·· 
.
·· 
log
·· 
(
·· 
string
·· 
.
·· 
Format
·· #
(
··# $
$str
··$ q
,
··q r
body
··s w
,
··w x
responseBody··y 
.·· 
ToString·· 
(·· 
)·· 
)·· 
,·· 
LogLevel·· 
.·· 
Error·· ¡
)··¡ ¢
;··¢ £
if
¸¸ 
(
¸¸ 
!
¸¸ 

signAppOut
¸¸ 
(
¸¸ 
)
¸¸ 
.
¸¸ 
Result
¸¸ $
)
¸¸$ %
{
¹¹ 
Utils
ºº 
.
ºº 
log
ºº 
(
ºº 
$str
ºº 4
,
ºº4 5
LogLevel
ºº6 >
.
ºº> ?
Error
ºº? D
)
ººD E
;
ººE F
}
»» 
return
¼¼ 
null
¼¼ 
;
¼¼ 
}
½½ 	
public
¿¿ 
static
¿¿ 
async
¿¿ 
Task
¿¿  
<
¿¿  !
String
¿¿! '
>
¿¿' (&
getCredentialByRequestID
¿¿) A
(
¿¿A B
String
¿¿B H
	requestID
¿¿I R
)
¿¿R S
{
ÀÀ 	
String
ÁÁ 
url
ÁÁ 
=
ÁÁ 
Settings
ÁÁ !
.
ÁÁ! "

BT_API_URL
ÁÁ" ,
+
ÁÁ- .
$str
ÁÁ/ >
+
ÁÁ? @
	requestID
ÁÁA J
;
ÁÁJ K
HttpClientHandler
ÂÂ 
handler
ÂÂ %
=
ÂÂ& '%
createHttpClientHandler
ÂÂ( ?
(
ÂÂ? @
)
ÂÂ@ A
;
ÂÂA B

HttpClient
ÃÃ 
client
ÃÃ 
=
ÃÃ 
new
ÃÃ  #

HttpClient
ÃÃ$ .
(
ÃÃ. /
handler
ÃÃ/ 6
)
ÃÃ6 7
;
ÃÃ7 8 
HttpRequestMessage
ÄÄ 
request
ÄÄ &
=
ÄÄ' (
new
ÄÄ) , 
HttpRequestMessage
ÄÄ- ?
(
ÄÄ? @

HttpMethod
ÄÄ@ J
.
ÄÄJ K
Get
ÄÄK N
,
ÄÄN O
url
ÄÄP S
)
ÄÄS T
;
ÄÄT U
request
ÅÅ 
.
ÅÅ 
Headers
ÅÅ 
.
ÅÅ 
Add
ÅÅ 
(
ÅÅ  
$str
ÅÅ  (
,
ÅÅ( )
$str
ÅÅ* <
)
ÅÅ< =
;
ÅÅ= >
request
ÆÆ 
.
ÆÆ 
Headers
ÆÆ 
.
ÆÆ %
TryAddWithoutValidation
ÆÆ 3
(
ÆÆ3 4
$str
ÆÆ4 C
,
ÆÆC D
Settings
ÆÆE M
.
ÆÆM N
REQUEST_HEADERS
ÆÆN ]
)
ÆÆ] ^
;
ÆÆ^ _!
HttpResponseMessage
ÇÇ 
response
ÇÇ  (
=
ÇÇ) *
await
ÇÇ+ 0
client
ÇÇ1 7
.
ÇÇ7 8
	SendAsync
ÇÇ8 A
(
ÇÇA B
request
ÇÇB I
)
ÇÇI J
;
ÇÇJ K
String
ÈÈ 
responseBody
ÈÈ 
=
ÈÈ  !
await
ÈÈ" '
response
ÈÈ( 0
.
ÈÈ0 1
Content
ÈÈ1 8
.
ÈÈ8 9
ReadAsStringAsync
ÈÈ9 J
(
ÈÈJ K
)
ÈÈK L
;
ÈÈL M
if
ÉÉ 
(
ÉÉ 
response
ÉÉ 
.
ÉÉ 

StatusCode
ÉÉ #
==
ÉÉ$ &
HttpStatusCode
ÉÉ' 5
.
ÉÉ5 6
OK
ÉÉ6 8
)
ÉÉ8 9
{
ÊÊ 
return
ÌÌ 
Regex
ÌÌ 
.
ÌÌ 
Replace
ÌÌ $
(
ÌÌ$ %
responseBody
ÌÌ% 1
,
ÌÌ1 2
$str
ÌÌ3 <
,
ÌÌ< =
$str
ÌÌ> @
)
ÌÌ@ A
;
ÌÌA B
}
ÍÍ 
Utils
ÎÎ 
.
ÎÎ 
log
ÎÎ 
(
ÎÎ 
string
ÎÎ 
.
ÎÎ 
Format
ÎÎ #
(
ÎÎ# $
$strÎÎ$ 
,ÎÎ 
	requestIDÎÎ 
,ÎÎ 
responseBodyÎÎ 
.ÎÎ 
ToStringÎÎ ¦
(ÎÎ¦ §
)ÎÎ§ ¨
)ÎÎ¨ ©
,ÎÎ© ª
LogLevelÎÎ« ³
.ÎÎ³ ´
ErrorÎÎ´ ¹
)ÎÎ¹ º
;ÎÎº »
if
ÏÏ 
(
ÏÏ 
!
ÏÏ 

signAppOut
ÏÏ 
(
ÏÏ 
)
ÏÏ 
.
ÏÏ 
Result
ÏÏ $
)
ÏÏ$ %
{
ÐÐ 
Utils
ÑÑ 
.
ÑÑ 
log
ÑÑ 
(
ÑÑ 
$str
ÑÑ 4
,
ÑÑ4 5
LogLevel
ÑÑ6 >
.
ÑÑ> ?
Error
ÑÑ? D
)
ÑÑD E
;
ÑÑE F
}
ÒÒ 
return
ÓÓ 
null
ÓÓ 
;
ÓÓ 
}
ÔÔ 	
}
ÕÕ 
}ÖÖ £
5C:\Users\abdul\source\repos\BeyondInsight\LogLevel.cs
	namespace 	
BeyondInsight
 
{ 
public 

enum 
LogLevel 
{ 
Trace		 
,		 
Debug

 
,

 
Information 
, 
Warning 
, 
Error 
, 
Critical 
} 
} â
:C:\Users\abdul\source\repos\BeyondInsight\BeyondInsight.cs
	namespace 	
BeyondInsight
 
{ 
public		 

class		 
BeyondInsight		 
{

 
public 
static 
JObject 

getSecrets (
(( )
)) *
{ 	
Utils 
. 
log 
( 
$str %
+& '
Settings( 0
.0 1
APP_VERSION1 <
,< =
LogLevel> F
.F G
InformationG R
)R S
;S T
Utils 
. 
log 
( 
$str -
+. /
Settings0 8
.8 9
EXCECUTION_ID9 F
,F G
LogLevelH P
.P Q
InformationQ \
)\ ]
;] ^
Utils 
. 
log 
( 
$str )
,) *
LogLevel+ 3
.3 4
Information4 ?
)? @
;@ A
String 

secretList 
= 
Settings  (
.( )
SECRETS_LIST) 5
.5 6
ToLower6 =
(= >
)> ?
;? @
String 

folderList 
= 
Settings  (
.( )
FOLDER_LIST) 4
.4 5
ToLower5 <
(< =
)= >
;> ?
String 
managedAccountList %
=& '
Settings( 0
.0 1!
MANAGED_ACCOUNTS_LIST1 F
.F G
ToLowerG N
(N O
)O P
;P Q
try 
{ 
if 
( 
String 
. 
IsNullOrWhiteSpace -
(- .
Settings. 6
.6 7

BT_API_URL7 A
)A B
)B C
{ 
throw 
new 
	Exception '
(' (
$str( >
)> ?
;? @
}   
if!! 
(!! 
String!! 
.!! 
IsNullOrWhiteSpace!! -
(!!- .
Settings!!. 6
.!!6 7!
BT_CLIENT_CERTIFICATE!!7 L
)!!L M
)!!M N
{"" 
throw## 
new## 
	Exception## '
(##' (
$str##( I
)##I J
;##J K
}$$ 
Task&& 
<&& 
String&& 
>&& 
user&& !
=&&" #
Service&&$ +
.&&+ ,
	SignAppIn&&, 5
(&&5 6
)&&6 7
;&&7 8
Console'' 
.'' 
	WriteLine'' !
(''! "
user''" &
.''& '
Result''' -
)''- .
;''. /
if** 
(** 
user** 
!=** 
null**  
)**  !
{++ 
JObject,, 
secrets,, #
=,,$ %
getSecretsFromBT,,& 6
(,,6 7

secretList,,7 A
,,,A B

folderList,,C M
,,,M N
managedAccountList,,O a
),,a b
;,,b c
Utils-- 
.-- 
log-- 
(-- 
$str-- 0
+--1 2
Settings--3 ;
.--; <
EXCECUTION_ID--< I
,--I J
LogLevel--K S
.--S T
Information--T _
)--_ `
;--` a
if.. 
(.. 
!.. 
Service..  
...  !

signAppOut..! +
(..+ ,
).., -
...- .
Result... 4
)..4 5
{// 
throw00 
new00 !
	Exception00" +
(00+ ,
$str00, =
)00= >
;00> ?
}11 
return22 
secrets22 "
;22" #
}33 
else33 
{44 
Utils55 
.55 
log55 
(55 
$str55 .
,55. /
LogLevel550 8
.558 9
Error559 >
)55> ?
;55? @
}66 
}77 
catch77 
(77 
	Exception77 
ex77 !
)77! "
{88 
Console99 
.99 
	WriteLine99 !
(99! "
$str99" +
+99, -
ex99. 0
.990 1
Message991 8
)998 9
;999 :
Console:: 
.:: 
	WriteLine:: !
(::! "
$str::" ,
+::- .
ex::/ 1
.::1 2
ToString::2 :
(::: ;
)::; <
)::< =
;::= >
};; 
return>> 
null>> 
;>> 
}?? 	
publicBB 
staticBB 
JObjectBB 
getSecretsFromBTBB .
(BB. /
StringBB/ 5

secretListBB6 @
,BB@ A
StringBBB H

folderListBBI S
,BBS T
StringBBU [
managedAccountListBB\ n
)BBn o
{CC 	
JArrayDD 
secretsDD 
=DD 
newDD  
JArrayDD! '
(DD' (
)DD( )
;DD) *
tryEE 
{EE 
ifFF 
(FF 
!FF 
StringFF 
.FF 
IsNullOrWhiteSpaceFF .
(FF. /

secretListFF/ 9
)FF9 :
||FF; =
!FF> ?
StringFF? E
.FFE F
IsNullOrWhiteSpaceFFF X
(FFX Y

folderListFFY c
)FFc d
)FFd e
{GG 
secretsHH 
=HH .
"getSecretsByFolderPathOrSecretPathHH @
(HH@ A

secretListHHA K
,HHK L

folderListHHM W
)HHW X
;HHX Y
}II 
ifJJ 
(JJ 
SettingsJJ 
.JJ &
FETCH_ALL_MANAGED_ACCOUNTSJJ 7
)JJ7 8
{KK 
StringLL 
[LL 
]LL 
managedAccountsLL ,
=LL- .
getManagedAccountsLL/ A
(LLA B
)LLB C
;LLC D
JArrayMM 
managedSecretsMM )
=MM* +0
$getSecretsBySystemNameAndAccountNameMM, P
(MMP Q
managedAccountsMMQ `
)MM` a
;MMa b
secretsNN 
=NN 
joinSecretsNN )
(NN) *
secretsNN* 1
,NN1 2
managedSecretsNN3 A
)NNA B
;NNB C
}OO 
elseOO 
ifOO 
(OO 
!OO 
StringOO "
.OO" #
IsNullOrWhiteSpaceOO# 5
(OO5 6
managedAccountListOO6 H
)OOH I
)OOI J
{PP 
JArrayQQ 
managedSecretsQQ )
=QQ* +0
$getSecretsBySystemNameAndAccountNameQQ, P
(QQP Q
managedAccountListQQQ c
.QQc d
SplitQQd i
(QQi j
$charQQj m
)QQm n
)QQn o
;QQo p
secretsRR 
=RR 
joinSecretsRR )
(RR) *
secretsRR* 1
,RR1 2
managedSecretsRR3 A
)RRA B
;RRB C
}SS 
JObjectUU 
resultUU 
=UU  $
generateSecretJSONObjectUU! 9
(UU9 :
secretsUU: A
)UUA B
;UUB C
returnVV 
resultVV 
;VV 
}XX 
catchXX 
(XX 
	ExceptionXX 
exXX !
)XX! "
{XX# $
UtilsYY 
.YY 
logYY 
(YY 
stringYY  
.YY  !
FormatYY! '
(YY' (
$strYY( 4
,YY4 5
exYY6 8
.YY8 9
MessageYY9 @
)YY@ A
,YYA B
LogLevelYYC K
.YYK L
ErrorYYL Q
)YYQ R
;YYR S
}ZZ 
return[[ 
null[[ 
;[[ 
}\\ 	
public^^ 
static^^ 
JArray^^ 0
$getSecretsBySystemNameAndAccountName^^ A
(^^A B
String^^B H
[^^H I
]^^I J
managedAccounts^^K Z
)^^Z [
{__ 	
JArray`` 
secrets`` 
=`` 
new``  
JArray``! '
(``' (
)``( )
;``) *
foreachaa 
(aa 
Stringaa 
manageAccountaa )
inaa* ,
managedAccountsaa- <
)aa< =
{bb 
stringcc 
[cc 
]cc 
datacc 
=cc 
manageAccountcc  -
.cc- .
Trimcc. 2
(cc2 3
)cc3 4
.cc4 5
Splitcc5 :
(cc: ;
$charcc; >
)cc> ?
;cc? @
ifdd 
(dd 
datadd 
.dd 
Lengthdd 
!=dd  "
$numdd# $
)dd$ %
{ee 
Utilsff 
.ff 
logff 
(ff 
stringff $
.ff$ %
Formatff% +
(ff+ ,
$strff, J
,ffJ K
manageAccountffL Y
.ffY Z
TrimffZ ^
(ff^ _
)ff_ `
)ff` a
,ffa b
LogLevelffc k
.ffk l
Errorffl q
)ffq r
;ffr s
continuegg 
;gg 
}hh 
Stringii 

systemNameii !
=ii" #
dataii$ (
[ii( )
$numii) *
]ii* +
;ii+ ,
Stringjj 
accountNamejj "
=jj# $
datajj% )
[jj) *
$numjj* +
]jj+ ,
;jj, -
Stringll 

secretPathll !
=ll" #

systemNamell$ .
+ll/ 0
$strll1 4
+ll5 6
accountNamell7 B
;llB C
Stringmm 
responsemm 
=mm  !
Servicemm" )
.mm) *
getManagedAccountsmm* <
(mm< =

systemNamemm= G
,mmG H
accountNamemmI T
)mmT U
.mmU V
ResultmmV \
;mm\ ]
ifnn 
(nn 
Stringnn 
.nn 
IsNullOrEmptynn (
(nn( )
responsenn) 1
)nn1 2
||nn3 5
responsenn6 >
.nn> ?
Equalsnn? E
(nnE F
$strnnF a
)nna b
)nnb c
{oo 
Utilspp 
.pp 
logpp 
(pp 
Stringpp $
.pp$ %
Formatpp% +
(pp+ ,
$strpp, J
,ppJ K

secretPathppL V
)ppV W
,ppW X
LogLevelppY a
.ppa b
Errorppb g
)ppg h
;pph i
continueqq 
;qq 
}rr 
JObjectss 

jsonObjectss "
=ss# $
JObjectss% ,
.ss, -
Parsess- 2
(ss2 3
responsess3 ;
)ss; <
;ss< =
inttt 
systemIDtt 
=tt 

jsonObjecttt )
.tt) *
Valuett* /
<tt/ 0
inttt0 3
>tt3 4
(tt4 5
$strtt5 ?
)tt? @
;tt@ A
intuu 
	accountIDuu 
=uu 

jsonObjectuu  *
.uu* +
Valueuu+ 0
<uu0 1
intuu1 4
>uu4 5
(uu5 6
$struu6 A
)uuA B
;uuB C
Stringvv 
	requestIDvv  
=vv! "
Servicevv# *
.vv* +'
createRequestInPasswordSafevv+ F
(vvF G
systemIDvvG O
,vvO P
	accountIDvvQ Z
)vvZ [
.vv[ \
Resultvv\ b
;vvb c
Stringww 

credentialww !
=ww" #
Serviceww$ +
.ww+ ,$
getCredentialByRequestIDww, D
(wwD E
	requestIDwwE N
)wwN O
.wwO P
ResultwwP V
;wwV W
secretsxx 
.xx 
Addxx 
(xx 
Utilsxx !
.xx! ")
convertManagedAccountToObjectxx" ?
(xx? @

jsonObjectxx@ J
,xxJ K

credentialxxL V
)xxV W
)xxW X
;xxX Y
}yy 
return{{ 
secrets{{ 
;{{ 
}|| 	
public~~ 
static~~ 
JArray~~ .
"getSecretsByFolderPathOrSecretPath~~ ?
(~~? @
String~~@ F
secretsBySecretPath~~G Z
,~~Z [
String~~\ b
secretsByFolderPath~~c v
)~~v w
{ 	
JArray
 
secrets
 
=
 
new
  
JArray
! '
(
' (
)
( )
;
) *
char
 
	separator
 
=
 
$char
  
;
  !
if
 
(
 !
secretsBySecretPath
 #
!=
$ &
null
' +
&&
, .
!
/ 0
String
0 6
.
6 7
IsNullOrEmpty
7 D
(
D E!
secretsBySecretPath
E X
)
X Y
)
Y Z
{
 
String
 
[
 
]
 
paths
 
=
  !
secretsBySecretPath
! 4
.
4 5
Split
5 :
(
: ;
$char
; >
)
> ?
;
? @
foreach
 
(
 
String
 

secretPath
  *
in
+ -
paths
. 3
)
3 4
{
 
if
 
(
 
String
 
.
  
IsNullOrWhiteSpace
 1
(
1 2

secretPath
2 <
)
< =
)
= >
continue
? G
;
G H
String
 
[
 
]
 
foldersInPath
 *
=
+ ,

secretPath
- 7
.
7 8
Trim
8 <
(
< =
)
= >
.
> ?
Split
? D
(
D E
	separator
E N
)
N O
;
O P
String
 
title
  
=
! "
foldersInPath
# 0
[
0 1
foldersInPath
1 >
.
> ?
Length
? E
-
F G
$num
H I
]
I J
;
J K
string
 
path
 
=
  !
string
" (
.
( )
Join
) -
(
- .
	separator
. 7
.
7 8
ToString
8 @
(
@ A
)
A B
,
B C
foldersInPath
D Q
.
Q R
Take
R V
(
V W
foldersInPath
W d
.
d e
Length
e k
-
l m
$num
n o
)
o p
)
p q
;
q r
String
 
response
 #
=
$ %
Service
& -
.
- .
getSecretByPath
. =
(
= >
path
> B
,
B C
title
D I
,
I J
	separator
K T
,
T U
true
V Z
)
Z [
.
[ \
Result
\ b
;
b c
if
 
(
 
response
  
.
  !
Length
! '
<=
( *
$num
+ ,
)
, -
{
 
Utils
 
.
 
log
 !
(
! "
string
" (
.
( )
Format
) /
(
/ 0
$str
0 f
,
f g
path
h l
,
l m
title
n s
,
s t
string
u {
.
{ |
Join| 
( 
$str 
, 
foldersInPath 
) 
) 
, 
LogLevel  
.  ¡
Information¡ ¬
)¬ ­
;­ ®
response
  
=
! "
Service
# *
.
* +
getSecretByPath
+ :
(
: ;
string
; A
.
A B
Join
B F
(
F G
	separator
G P
.
P Q
ToString
Q Y
(
Y Z
)
Z [
,
[ \
foldersInPath
] j
)
j k
,
k l
title
m r
,
r s
	separator
t }
,
} ~
false 
) 
. 
Result 
; 
if
 
(
 
response
 $
.
$ %
Length
% +
<=
, .
$num
/ 0
)
0 1
{
 
Utils
 !
.
! "
log
" %
(
% &
string
& ,
.
, -
Format
- 3
(
3 4
$str
4 Y
,
Y Z

secretPath
[ e
)
e f
,
f g
LogLevel
h p
.
p q
Error
q v
)
v w
;
w x
continue
 $
;
$ %
}
 
JArray
 
	jsonArray
 (
=
) *
JArray
+ 1
.
1 2
Parse
2 7
(
7 8
response
8 @
)
@ A
;
A B
for
 
(
 
int
  
i
! "
=
# $
$num
% &
;
& '
i
( )
<
* +
	jsonArray
, 5
.
5 6
Count
6 ;
;
; <
i
= >
++
> @
)
@ A
{
 
JObject
 #

jsonObject
$ .
=
/ 0
(
1 2
JObject
2 9
)
9 :
	jsonArray
: C
[
C D
i
D E
]
E F
;
F G
JObject
 #
secret
$ *
=
+ ,#
get_secrets_in_folder
- B
(
B C

jsonObject
C M
)
M N
;
N O
if
 
(
  
secret
  &
!=
' )
null
* .
)
. /
{
   
secrets
¡¡  '
.
¡¡' (
Add
¡¡( +
(
¡¡+ ,
secret
¡¡, 2
)
¡¡2 3
;
¡¡3 4
}
¢¢ 
}
¤¤ 
}
¥¥ 
else
¥¥ 
{
¦¦ 
JArray
§§ 
	jsonArray
§§ (
=
§§) *
JArray
§§+ 1
.
§§1 2
Parse
§§2 7
(
§§7 8
response
§§8 @
)
§§@ A
;
§§A B
for
¨¨ 
(
¨¨ 
int
¨¨  
i
¨¨! "
=
¨¨# $
$num
¨¨% &
;
¨¨& '
i
¨¨' (
<
¨¨) *
	jsonArray
¨¨+ 4
.
¨¨4 5
Count
¨¨5 :
;
¨¨: ;
i
¨¨< =
++
¨¨= ?
)
¨¨? @
{
©© 
JObject
ªª #

jsonObject
ªª$ .
=
ªª/ 0
(
ªª1 2
JObject
ªª2 9
)
ªª9 :
	jsonArray
ªª: C
[
ªªC D
i
ªªD E
]
ªªE F
;
ªªF G
if
«« 
(
««  

jsonObject
««  *
.
««* +
Value
««+ 0
<
««0 1
string
««1 7
>
««7 8
(
««8 9
$str
««9 E
)
««E F
.
««F G
Equals
««G M
(
««M N
$str
««N T
)
««T U
)
««U V
{
¬¬ 
String
­­  &
fileContent
­­' 2
=
­­3 4
Service
­­5 <
.
­­< =
getSecretFilebyId
­­= N
(
­­N O

jsonObject
­­O Y
.
­­Y Z
Value
­­Z _
<
­­_ `
string
­­` f
>
­­f g
(
­­g h
$str
­­h l
)
­­l m
)
­­m n
.
­­n o
Result
­­o u
;
­­u v
if
®®  "
(
®®# $
!
®®$ %
String
®®% +
.
®®+ ,
IsNullOrEmpty
®®, 9
(
®®9 :
fileContent
®®: E
)
®®E F
)
®®F G
{
¯¯  !
JObject
°°$ +
secret
°°, 2
=
°°3 4
Utils
°°5 :
.
°°: ;
createSecretFile
°°; K
(
°°K L

jsonObject
°°L V
,
°°V W
fileContent
°°X c
)
°°c d
;
°°d e
if
±±$ &
(
±±' (
secret
±±( .
!=
±±/ 1
null
±±2 6
)
±±6 7
{
²²$ %
secrets
³³( /
.
³³/ 0
Add
³³0 3
(
³³3 4
secret
³³4 :
)
³³: ;
;
³³; <
}
´´$ %
}
µµ  !
else
µµ" &
{
¶¶  !
Utils
··$ )
.
··) *
log
··* -
(
··- .
string
··. 4
.
··4 5
Format
··5 ;
(
··; <
$str
··< m
,
··m n

jsonObject
··o y
.
··y z
ToString··z 
(·· 
)·· 
)·· 
,·· 
LogLevel·· 
.·· 
Error·· 
)·· 
;·· 
continue
¸¸$ ,
;
¸¸, -
}
¹¹  !
}
ºº 
else
ºº "
{
»» 
JObject
¼¼  '
secret
¼¼( .
=
¼¼/ 0
Utils
¼¼1 6
.
¼¼6 7#
convertSecretToObject
¼¼7 L
(
¼¼L M

jsonObject
¼¼M W
)
¼¼W X
;
¼¼X Y
if
½½  "
(
½½# $
secret
½½$ *
!=
½½+ -
null
½½. 2
)
½½2 3
{
¾¾  !
secrets
¿¿$ +
.
¿¿+ ,
Add
¿¿, /
(
¿¿/ 0
secret
¿¿0 6
)
¿¿6 7
;
¿¿7 8
}
ÀÀ  !
}
ÁÁ 
}
ÂÂ 
}
ÃÃ 
}
ÄÄ 
}
ÅÅ 
if
ÇÇ 
(
ÇÇ !
secretsByFolderPath
ÇÇ #
!=
ÇÇ$ &
null
ÇÇ' +
&&
ÇÇ, .
!
ÇÇ/ 0
String
ÇÇ0 6
.
ÇÇ6 7
IsNullOrEmpty
ÇÇ7 D
(
ÇÇD E!
secretsByFolderPath
ÇÇE X
)
ÇÇX Y
)
ÇÇY Z
{
ÈÈ 
String
ÉÉ 
[
ÉÉ 
]
ÉÉ 
folders
ÉÉ  
=
ÉÉ! "!
secretsByFolderPath
ÉÉ# 6
.
ÉÉ6 7
Split
ÉÉ7 <
(
ÉÉ< =
$char
ÉÉ= @
)
ÉÉ@ A
;
ÉÉA B
Utils
ÊÊ 
.
ÊÊ 
log
ÊÊ 
(
ÊÊ 
string
ÊÊ  
.
ÊÊ  !
Format
ÊÊ! '
(
ÊÊ' (
$str
ÊÊ( H
,
ÊÊH I
string
ÊÊJ P
.
ÊÊP Q
Join
ÊÊQ U
(
ÊÊU V
$str
ÊÊV Z
,
ÊÊZ [
folders
ÊÊ\ c
)
ÊÊc d
)
ÊÊd e
,
ÊÊe f
LogLevel
ÊÊg o
.
ÊÊo p
Information
ÊÊp {
)
ÊÊ{ |
;
ÊÊ| }
foreach
ËË 
(
ËË 
String
ËË 
folder
ËË  &
in
ËË' )
folders
ËË* 1
)
ËË1 2
{
ÌÌ 
String
ÍÍ 
response
ÍÍ #
=
ÍÍ$ %
Service
ÍÍ& -
.
ÍÍ- .
getSecretByPath
ÍÍ. =
(
ÍÍ= >
folder
ÍÍ> D
,
ÍÍD E
$str
ÍÍF H
,
ÍÍH I
	separator
ÍÍJ S
,
ÍÍS T
false
ÍÍU Z
)
ÍÍZ [
.
ÍÍ[ \
Result
ÍÍ\ b
;
ÍÍb c
if
ÎÎ 
(
ÎÎ 
response
ÎÎ  
.
ÎÎ  !
Length
ÎÎ! '
<=
ÎÎ( *
$num
ÎÎ+ ,
)
ÎÎ, -
{
ÏÏ 
Utils
ÐÐ 
.
ÐÐ 
log
ÐÐ !
(
ÐÐ! "
string
ÐÐ" (
.
ÐÐ( )
Format
ÐÐ) /
(
ÐÐ/ 0
$str
ÐÐ0 U
,
ÐÐU V
folder
ÐÐW ]
)
ÐÐ] ^
,
ÐÐ^ _
LogLevel
ÐÐ` h
.
ÐÐh i
Error
ÐÐi n
)
ÐÐn o
;
ÐÐo p
continue
ÑÑ  
;
ÑÑ  !
}
ÒÒ 
JArray
ÓÓ 
	jsonArray
ÓÓ $
=
ÓÓ% &
JArray
ÓÓ' -
.
ÓÓ- .
Parse
ÓÓ. 3
(
ÓÓ3 4
response
ÓÓ4 <
)
ÓÓ< =
;
ÓÓ= >
for
ÔÔ 
(
ÔÔ 
int
ÔÔ 
i
ÔÔ 
=
ÔÔ 
$num
ÔÔ  !
;
ÔÔ! "
i
ÔÔ# $
<
ÔÔ% &
	jsonArray
ÔÔ' 0
.
ÔÔ0 1
Count
ÔÔ1 6
;
ÔÔ6 7
i
ÔÔ8 9
++
ÔÔ9 ;
)
ÔÔ; <
{
ÕÕ 
JObject
ÖÖ 

jsonObject
ÖÖ  *
=
ÖÖ+ ,
(
ÖÖ- .
JObject
ÖÖ. 5
)
ÖÖ5 6
	jsonArray
ÖÖ6 ?
[
ÖÖ? @
i
ÖÖ@ A
]
ÖÖA B
;
ÖÖB C
JObject
×× 
secret
××  &
=
××' (#
get_secrets_in_folder
××) >
(
××> ?

jsonObject
××? I
)
××I J
;
××J K
if
ØØ 
(
ØØ 
secret
ØØ "
!=
ØØ# %
null
ØØ& *
)
ØØ* +
{
ÙÙ 
secrets
ÚÚ #
.
ÚÚ# $
Add
ÚÚ$ '
(
ÚÚ' (
secret
ÚÚ( .
)
ÚÚ. /
;
ÚÚ/ 0
}
ÛÛ 
}
ÜÜ 
}
ÝÝ 
}
ÞÞ 
return
ßß 
secrets
ßß 
;
ßß 
}
àà 	
public
ââ 
static
ââ 
JObject
ââ #
get_secrets_in_folder
ââ 3
(
ââ3 4
JObject
ââ4 ;
secret
ââ< B
)
ââB C
{
ãã 	
if
ää 
(
ää 
$str
ää 
.
ää 
Equals
ää 
(
ää 
secret
ää $
.
ää$ %
Value
ää% *
<
ää* +
string
ää+ 1
>
ää1 2
(
ää2 3
$str
ää3 ?
)
ää? @
)
ää@ A
)
ääA B
{
åå 
String
ææ 
fileContent
ææ "
=
ææ# $
Service
ææ% ,
.
ææ, -
getSecretFilebyId
ææ- >
(
ææ> ?
secret
ææ? E
.
ææE F
Value
ææF K
<
ææK L
string
ææL R
>
ææR S
(
ææS T
$str
ææT X
)
ææX Y
)
ææY Z
.
ææZ [
Result
ææ[ a
;
ææa b
if
çç 
(
çç 
!
çç 
String
çç 
.
çç 
IsNullOrEmpty
çç )
(
çç) *
fileContent
çç* 5
)
çç5 6
)
çç6 7
{
èè 
return
éé 
Utils
éé  
.
éé  !
createSecretFile
éé! 1
(
éé1 2
secret
éé2 8
,
éé8 9
fileContent
éé: E
)
ééE F
;
ééF G
}
êê 
else
êê 
{
ëë 
Utils
ìì 
.
ìì 
log
ìì 
(
ìì 
string
ìì $
.
ìì$ %
Format
ìì% +
(
ìì+ ,
$str
ìì, ]
,
ìì] ^
secret
ìì_ e
)
ììe f
,
ììf g
LogLevel
ììh p
.
ììp q
Error
ììq v
)
ììv w
;
ììw x
return
íí 
null
íí 
;
íí  
}
îî 
}
ïï 
else
ïï 
{
ðð 
return
ññ 
Utils
ññ 
.
ññ #
convertSecretToObject
ññ 2
(
ññ2 3
secret
ññ3 9
)
ññ9 :
;
ññ: ;
}
òò 
}
óó 	
public
õõ 
static
õõ 
String
õõ 
[
õõ 
]
õõ  
getManagedAccounts
õõ 1
(
õõ1 2
)
õõ2 3
{
öö 	
char
÷÷ 
	separator
÷÷ 
=
÷÷ 
$char
÷÷ !
;
÷÷! "
String
øø 
response
øø 
=
øø 
Service
øø %
.
øø% & 
getManagedAccounts
øø& 8
(
øø8 9
$str
øø9 ;
,
øø; <
$str
øø= ?
)
øø? @
.
øø@ A
Result
øøA G
;
øøG H
JArray
ùù 
	jsonArray
ùù 
=
ùù 
JArray
ùù %
.
ùù% &
Parse
ùù& +
(
ùù+ ,
response
ùù, 4
)
ùù4 5
;
ùù5 6
String
úú 
[
úú 
]
úú 
managedAccounts
úú $
=
úú% &
new
úú' *
String
úú+ 1
[
úú1 2
	jsonArray
úú2 ;
.
úú; <
Count
úú< A
]
úúA B
;
úúB C
for
ûû 
(
ûû 
int
ûû 
i
ûû 
=
ûû 
$num
ûû 
;
ûû 
i
ûû 
<
ûû 
	jsonArray
ûû  )
.
ûû) *
Count
ûû* /
;
ûû/ 0
i
ûû1 2
++
ûû2 4
)
ûû4 5
{
üü 
JObject
ýý 

jsonObject
ýý "
=
ýý# $
(
ýý% &
JObject
ýý& -
)
ýý- .
	jsonArray
ýý. 7
[
ýý7 8
i
ýý8 9
]
ýý9 :
;
ýý: ;
managedAccounts
þþ 
[
þþ  
i
þþ  !
]
þþ! "
=
þþ# $

jsonObject
þþ% /
.
þþ/ 0
Value
þþ0 5
<
þþ5 6
string
þþ6 <
>
þþ< =
(
þþ= >
$str
þþ> J
)
þþJ K
+
þþL M
$str
þþN Q
+
þþR S

jsonObject
þþT ^
.
þþ^ _
Value
þþ_ d
<
þþd e
string
þþe k
>
þþk l
(
þþl m
$str
þþm z
)
þþz {
;
þþ{ |
}
ÿÿ 
return
 
managedAccounts
 "
;
" #
}
 	
public
 
static
 
JObject
 &
generateSecretJSONObject
 6
(
6 7
JArray
7 =
	jsonArray
> G
)
G H
{
 	
JObject
 
result
 
=
 
new
  
JObject
! (
(
( )
)
) *
;
* +
foreach
 
(
 
JObject
 
item
 !
in
" $
	jsonArray
% .
)
. /
{
 
String
 

folderPath
 !
=
" #
item
$ (
[
( )
$str
) 5
]
5 6
?
6 7
.
7 8
ToString
8 @
(
@ A
)
A B
;
B C
String
 
[
 
]
 
folders
  
=
! "

folderPath
# -
.
- .
Split
. 3
(
3 4
$char
4 7
)
7 8
;
8 9
JObject
 
current
 
=
  !
result
" (
;
( )
for
 
(
 
int
 
i
 
=
 
$num
 
;
 
i
  
<
! "
folders
# *
.
* +
Length
+ 1
;
1 2
i
2 3
++
3 5
)
5 6
{
 
String
 
folder
 !
=
" #
folders
$ +
[
+ ,
i
, -
]
- .
;
. /
if
 
(
 
!
 
current
  
.
  !
ContainsKey
! ,
(
, -
folder
- 3
)
3 4
)
4 5
{
 
if
 
(
 
item
  
.
  !
ContainsKey
! ,
(
, -
$str
- :
)
: ;
&&
< >
folder
? E
==
F H
folders
I P
[
P Q
folders
Q X
.
X Y
Count
Y ^
(
^ _
)
_ `
-
a b
$num
b c
]
d e
)
e f
{
 
string
 "
accountName
# .
=
/ 0
item
1 5
[
5 6
$str
6 C
]
C D
?
D E
.
E F
ToString
F N
(
N O
)
O P
??
Q S
$str
T V
;
V W
current
 #
[
# $
accountName
$ /
]
/ 0
=
1 2
JObject
3 :
.
: ;
Parse
; @
(
@ A
item
A E
.
E F
ToString
F N
(
N O
)
O P
)
P Q
;
Q R
}
 
else
 
{
 
current
 #
[
# $
folder
$ *
]
* +
=
, -
new
. 1
JObject
2 9
(
9 :
)
: ;
;
; <
}
 
}
 
if
 
(
 
current
 
[
  
folder
  &
]
& '
is
( *
JObject
+ 2
nested
3 9
)
9 :
{
 
current
 
=
  !
nested
" (
;
( )
}
 
}
 
if
 
(
 
item
 
.
 
ContainsKey
 $
(
$ %
$str
% ,
)
, -
)
- .
{
   
string
¡¡ 
title
¡¡  
=
¡¡! "
item
¡¡# '
[
¡¡' (
$str
¡¡( /
]
¡¡/ 0
?
¡¡0 1
.
¡¡1 2
ToString
¡¡2 :
(
¡¡: ;
)
¡¡; <
??
¡¡= ?
$str
¡¡@ B
;
¡¡B C
JObject
¢¢ 
temp
¢¢  
=
¢¢! "
item
¢¢# '
;
¢¢' (
if
££ 
(
££ 
!
££ 
current
££  
.
££  !
ContainsKey
££! ,
(
££, -
title
££- 2
)
££2 3
)
££3 4
{
¤¤ 
current
¥¥ 
[
¥¥  
title
¥¥  %
]
¥¥% &
=
¥¥' (
JObject
¥¥) 0
.
¥¥0 1
Parse
¥¥1 6
(
¥¥6 7
item
¥¥7 ;
.
¥¥; <
ToString
¥¥< D
(
¥¥D E
)
¥¥E F
)
¥¥F G
;
¥¥G H
}
¦¦ 
}
§§ 
}
¨¨ 
return
©© 
result
©© 
;
©© 
}
ªª 	
public
¬¬ 
static
¬¬ 
JArray
¬¬ 
joinSecrets
¬¬ (
(
¬¬( )
JArray
¬¬) /
secrets
¬¬0 7
,
¬¬7 8
JArray
¬¬9 ?
secrets2
¬¬@ H
)
¬¬H I
{
­­ 	
foreach
¯¯ 
(
¯¯ 
JObject
¯¯ 
secret
¯¯ #
in
¯¯$ &
secrets2
¯¯' /
)
¯¯/ 0
{
°° 
secrets
±± 
.
±± 
Add
±± 
(
±± 
secret
±± "
.
±±" #
	DeepClone
±±# ,
(
±±, -
)
±±- .
)
±±. /
;
±±/ 0
}
²² 
return
³³ 
secrets
³³ 
;
³³ 
}
´´ 	
}
µµ 
}¶¶ 